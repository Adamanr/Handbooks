---
sidebar_position: 4
description: "Практика по основам PostgreSQL: DDL (CREATE/ALTER TABLE, CONSTRAINTS), DML (INSERT, RETURNING), первичные и внешние ключи, связи 1:N и N:N"
---

import { RandomVariantButton, TaskWithVariants, CodeBlockPostgres } from "../../src/components/practicModules/practic";

# Практика: Основы PostgreSQL — DDL и DML

<CodeBlockPostgres />


## Задание 1 — Простая таблица с разными ограничениями

<TaskWithVariants
  taskId="postgres-1-simple-table"
  title="Задание 1: Простая таблица с ограничениями"
  difficulty={["Лёгкий","Лёгкий","Лёгкий","Лёгкий","Лёгкий","Лёгкий","Лёгкий","Лёгкий","Средний","Средний","Средний","Средний"]}
  estimatedTime="10-15 минут"
  description="Создай таблицу с PRIMARY KEY, NOT NULL, UNIQUE, DEFAULT и CHECK."
  variants={[
    "Таблица employees (сотрудники)",
    "Таблица books (книги)",
    "Таблица students (студенты)",
    "Таблица products (товары)",
    "Таблица cars (автомобили)",
    "Таблица tasks (задачи)",
    "Таблица events (события)",
    "Таблица movies (фильмы)",
    "Таблица hotels (отели)",
    "Таблица articles (статьи)",
    "Таблица orders (заказы без позиций)",
    "Таблица courses (курсы)",
  ]}
>
  **Пример полей:**
  - id SERIAL PRIMARY KEY
  - name / title VARCHAR(100–150) NOT NULL
  - code / sku / isbn VARCHAR(50) UNIQUE
  - created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
  - active BOOLEAN DEFAULT TRUE
  
  **Требования:**
  - минимум одно CHECK (например, price > 0, year ≥ 1900, age ≥ 18 и т.п.)
  - Вставь 3–4 записи с помощью INSERT ... VALUES
  - Попробуй вставить некорректные данные → посмотри ошибки
</TaskWithVariants>

## Задание 2 — Связь один-ко-многим (автор → книги / категория → товары)

<TaskWithVariants
  taskId="postgres-2-one-to-many"
  title="Задание 2: Связь 1:N"
  difficulty={["Лёгкий","Лёгкий","Лёгкий","Лёгкий","Лёгкий","Средний","Средний","Средний","Средний","Средний","Средний","Средний"]}
  estimatedTime="15-20 минут"
  description="Создай две таблицы с FOREIGN KEY и разными ON DELETE."
  variants={[
    "Авторы → книги (ON DELETE CASCADE)",
    "Категории → товары (ON DELETE RESTRICT)",
    "Клиенты → заказы (ON DELETE SET NULL)",
    "Учителя → уроки (ON DELETE CASCADE)",
    "Бренды → модели телефонов (ON DELETE RESTRICT)",
    "Проекты → задачи (ON DELETE CASCADE)",
    "Страны → города (ON DELETE RESTRICT)",
    "Факультеты → студенты (ON DELETE SET NULL)",
    "Плейлисты → треки (ON DELETE CASCADE)",
    "Магазины → товары (ON DELETE RESTRICT)",
    "Серии → эпизоды сериала (ON DELETE CASCADE)",
    "Команды → игроки (ON DELETE SET NULL)",
  ]}
>
  **Требования:**
  - Родительская таблица: id SERIAL PRIMARY KEY, name VARCHAR(100) NOT NULL UNIQUE
  - Дочерняя таблица: id SERIAL PRIMARY KEY, name VARCHAR(150) NOT NULL, parent_id INTEGER NOT NULL REFERENCES parent(id) ON DELETE ...
  - Выбери подходящую стратегию ON DELETE
  - Вставь 2 записи в родительскую и по 3–4 в дочернюю
  - Попробуй удалить родительскую запись → посмотри, что произошло

  Пример:  
  DELETE FROM authors WHERE author_id = 1;  
  → все книги этого автора тоже удалятся (если CASCADE)
</TaskWithVariants>

## Задание 3 — Связь многие-ко-многим (студенты ↔ курсы)

<TaskWithVariants
  taskId="postgres-3-many-to-many"
  title="Задание 3: Связь N:N"
  difficulty={["Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний"]}
  estimatedTime="20-25 минут"
  description="Создай связующую таблицу для отношения многие-ко-многим."
  variants={[
    "Студенты ↔ курсы",
    "Пользователи ↔ роли (многие роли у пользователя)",
    "Товары ↔ теги",
    "Книги ↔ авторы (несколько авторов у книги)",
    "Фильмы ↔ актёры",
    "События ↔ участники",
    "Заказы ↔ промокоды",
    "Посты ↔ хэштеги",
    "Игроки ↔ команды (в разные периоды)",
    "Рецепты ↔ ингредиенты",
    "Новости ↔ категории",
    "Плейлисты ↔ песни",
  ]}
>
  **Требования:**
  - Две основные таблицы: id SERIAL PK, name VARCHAR(100) NOT NULL
  - Связующая таблица: (left_id, right_id) PRIMARY KEY, FOREIGN KEY ... ON DELETE CASCADE на обе стороны
  - Опционально: дата записи, статус и т.п.
  - Вставь по 3 записи в каждую основную таблицу и 5–8 связей

  Пример связующей таблицы:
  ```sql
  CREATE TABLE student_courses (
      student_id INTEGER REFERENCES students(student_id) ON DELETE CASCADE,
      course_id INTEGER REFERENCES courses(course_id) ON DELETE CASCADE,
      enrolled_at DATE DEFAULT CURRENT_DATE,
      PRIMARY KEY (student_id, course_id)
  );
  ```
</TaskWithVariants>

## Задание 4 — INSERT с RETURNING и ON CONFLICT

<TaskWithVariants
  taskId="postgres-4-insert-advanced"
  title="Задание 4: Продвинутый INSERT"
  difficulty={["Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний"]}
  estimatedTime="15-20 минут"
  description="Используй RETURNING и ON CONFLICT."
  variants={[
    "Вставка пользователя с возвратом id",
    "Добавление тега с ON CONFLICT DO NOTHING",
    "Обновление цены товара при конфликте sku (ON CONFLICT DO UPDATE)",
    "Добавление категории, если не существует",
    "Вставка заказа с возвратом order_id",
    "Добавление роли с ON CONFLICT DO UPDATE",
    "Вставка лога с RETURNING created_at",
    "Добавление промокода с проверкой уникальности",
    "Вставка комментария с возвратом comment_id",
    "Обновление статуса при повторной вставке",
    "Добавление ингредиента с ON CONFLICT",
    "Вставка события с возвратом всех полей",
  ]}
>
  **Требования:**
  - Используй `RETURNING *` или конкретные поля
  - Хотя бы один вариант с `ON CONFLICT DO NOTHING`
  - Хотя бы один с `ON CONFLICT ... DO UPDATE SET ... = EXCLUDED....`

  Пример:
  ```sql
  INSERT INTO products (sku, name, price)
  VALUES ('ABC123', 'Телефон', 39990)
  ON CONFLICT (sku)
  DO UPDATE SET
      price = EXCLUDED.price,
      updated_at = NOW()
  RETURNING product_id, name, price;
  ```
</TaskWithVariants>

## Задание 5 — ALTER TABLE: добавление и изменение полей

<TaskWithVariants
  taskId="postgres-5-alter"
  title="Задание 5: Изменение структуры таблицы"
  difficulty={["Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний","Средний"]}
  estimatedTime="15-20 минут"
  description="Добавь поля, ограничения, измени типы."
  variants={[
    "Добавить поле phone и email в users",
    "Добавить stock_quantity и CHECK >=0 в products",
    "Добавить is_published и published_at в posts",
    "Переименовать price → base_price",
    "Добавить UNIQUE на username",
    "Сделать email NOT NULL",
    "Добавить DEFAULT 'active' для status",
    "Добавить CHECK (age >= 18)",
    "Изменить VARCHAR(50) → VARCHAR(120) для name",
    "Добавить поле discount NUMERIC CHECK 0–100",
    "Добавить created_by INTEGER REFERENCES users",
    "Добавить updated_at DEFAULT NOW()",
  ]}
>
  **Требования:**
  - Сначала создай простую таблицу
  - Затем выполни 3–5 команд ALTER TABLE
  - После каждого ALTER используй \d для проверки

  Пример:
  ```sql
  ALTER TABLE users ADD COLUMN phone VARCHAR(20);
  ALTER TABLE users ADD CONSTRAINT unique_phone UNIQUE (phone);
  ALTER TABLE users ALTER COLUMN email SET NOT NULL;
  ```
</TaskWithVariants>

## Задание 6 — Мини-проект: структура интернет-магазина

<TaskWithVariants
  taskId="postgres-6-minishop"
  title="Задание 6: Полная структура мини-магазина (итоговое)"
  difficulty={["Сложный","Сложный","Сложный","Сложный","Сложный","Сложный","Сложный","Сложный","Сложный","Сложный","Сложный","Сложный"]}
  estimatedTime="30-45 минут"
  description="Создай 4–5 таблиц с правильными связями и вставь тестовые данные."
  variants={[
    "Магазин электроники",
    "Магазин одежды",
    "Книжный магазин",
    "Магазин косметики",
    "Магазин мебели",
    "Магазин игрушек",
    "Магазин спортивных товаров",
    "Магазин зоотоваров",
    "Магазин продуктов",
    "Магазин аксессуаров для телефонов",
    "Магазин подарков",
    "Магазин канцелярии",
  ]}
>
  **Требования:**
  - users (id, username, email, created_at)
  - categories (id, name UNIQUE)
  - products (id, name, price NUMERIC CHECK >0, category_id REFERENCES, stock INTEGER DEFAULT 0 CHECK >=0)
  - orders (id, user_id REFERENCES, created_at, status VARCHAR DEFAULT 'new' CHECK IN (...))
  - order_items (order_id, product_id, quantity CHECK >0, price_at_purchase NUMERIC)
  - Все FOREIGN KEY с подходящими ON DELETE
  - Вставь по 2–4 записи в каждую таблицу
  - Используй RETURNING хотя бы в одном INSERT

  После создания используй \dt и \d для проверки структуры.
</TaskWithVariants>

:::tip
Ошибки нарушения ограничений — твои лучшие учителя.  
Читай их внимательно — они почти всегда объясняют, что именно пошло не так.
:::
